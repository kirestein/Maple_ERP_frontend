<mat-card class="employee-form-container">
  <mat-card-header>
    <mat-card-title
      >{{ isEditMode ? "Editar" : "Cadastrar" }} Funcionário</mat-card-title
    >
    <mat-card-subtitle>
      {{ isEditMode ? "Atualize os dados do funcionário (campos não obrigatórios)" : "Preencha os dados do funcionário" }}
    </mat-card-subtitle>
  </mat-card-header>

  <mat-card-content>
    <form [formGroup]="employeeForm" (ngSubmit)="onSubmit()">
      <mat-stepper linear #stepper>
        <!-- ETAPA 1: INFORMAÇÕES BÁSICAS -->
        <mat-step [stepControl]="employeeForm.get('basicInfo')!">
          <ng-template matStepLabel>Informações Básicas</ng-template>
          <div class="step-content" formGroupName="basicInfo">
            <div class="photo-upload-container">
              <div
                class="photo-preview"
                [style.backgroundImage]="
                  selectedPhotoUrl ? 'url(' + selectedPhotoUrl + ')' : 'none'">
                <mat-icon *ngIf="!selectedPhotoUrl">person</mat-icon>
              </div>
              <button
                type="button"
                mat-raised-button
                color="primary"
                (click)="fileInput.click()"
              >
                <mat-icon>photo_camera</mat-icon> 
                {{ isEditMode ? 'Alterar Foto (Opcional)' : 'Selecionar Foto *' }}
              </button>
              <input
                hidden
                type="file"
                #fileInput
                (change)="onPhotoSelected($event)"
                accept="image/*"
              />
              <div class="photo-actions">
                <button
                  type="button"
                  mat-raised-button
                  color="accent"
                  (click)="fileInput.click()"
                >
                  <mat-icon>photo_camera</mat-icon>
                  {{ selectedPhotoUrl ? "Substituir" : "Enviar" }} Foto
                </button>
                <button
                  type="button"
                  mat-stroked-button
                  color="warn"
                  *ngIf="selectedPhotoUrl"
                  (click)="removePhoto()"
                >
                  <mat-icon>delete</mat-icon> Remover
                </button>
              </div>
              <input
                hidden
                type="file"
                #fileInput
                (change)="onPhotoSelected($event)"
                accept="image/jpeg,image/png"
              />
              <div class="photo-error" *ngIf="photoError">
                {{ photoError }}
              </div>
              <div class="photo-info" *ngIf="!isEditMode">
                <small>* Foto é obrigatória para novos funcionários</small>
              </div>
              <div class="photo-info" *ngIf="isEditMode && !selectedPhotoUrl">
                <small>Nenhuma foto cadastrada</small>
              </div>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Nome Completo {{ !isEditMode ? '*' : '' }}</mat-label>
                <input
                  matInput
                  formControlName="fullName"
                  placeholder="Nome completo do funcionário"
                  [required]="!isEditMode"
                />
                <mat-error
                  *ngIf="employeeForm.get('basicInfo.fullName')?.hasError('required')"
                >
                  Este campo é obrigatório.
                </mat-error>
                <mat-error
                  *ngIf="employeeForm.get('basicInfo.fullName')?.hasError('minlength')"
                >
                  Nome deve ter pelo menos 2 caracteres.
                </mat-error>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Nome para Crachá {{ !isEditMode ? '*' : '' }}</mat-label>
                <input
                  matInput
                  formControlName="tagName"
                  placeholder="Nome para o crachá"
                  [required]="!isEditMode"
                />
                <mat-error
                  *ngIf="employeeForm.get('basicInfo.tagName')?.hasError('required')"
                >
                  Este campo é obrigatório.
                </mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Sobrenome para Crachá {{ !isEditMode ? '*' : '' }}</mat-label>
                <input
                  matInput
                  formControlName="tagLastName"
                  placeholder="Sobrenome para o crachá"
                  [required]="!isEditMode"
                />
                <mat-error
                  *ngIf="employeeForm
                      .get('basicInfo.tagLastName')
                      ?.hasError('required')"
                >
                  Este campo é obrigatório.
                </mat-error>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>E-mail</mat-label>
                <input
                  matInput
                  formControlName="email"
                  placeholder="email@exemplo.com"
                  type="email"
                />
                <mat-error
                  *ngIf="employeeForm.get('basicInfo.email')?.hasError('email')"
                >
                  E-mail inválido
                </mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Data de Nascimento</mat-label>
                <input
                  matInput
                  [matDatepicker]="birthdayPicker"
                  formControlName="birthday"
                />
                <mat-datepicker-toggle
                  matSuffix
                  [for]="birthdayPicker"
                ></mat-datepicker-toggle>
                <mat-datepicker #birthdayPicker></mat-datepicker>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="third-width">
                <mat-label>Gênero</mat-label>
                <mat-select formControlName="gender">
                  <mat-option
                    *ngFor="let gender of genderOptions"
                    [value]="gender"
                  >
                    {{ gender }}
                  </mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline" class="third-width">
                <mat-label>Estado Civil</mat-label>
                <mat-select formControlName="maritalStatus">
                  <mat-option
                    *ngFor="let status of maritalStatusOptions"
                    [value]="status"
                  >
                    {{ status }}
                  </mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline" class="third-width">
                <mat-label>Cor/Raça</mat-label>
                <mat-select formControlName="skinColor">
                  <mat-option
                    *ngFor="let color of skinColorOptions"
                    [value]="color"
                  >
                    {{ color }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Naturalidade</mat-label>
                <input
                  matInput
                  formControlName="naturalness"
                  placeholder="Cidade de nascimento"
                />
              </mat-form-field>

              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Nacionalidade</mat-label>
                <input
                  matInput
                  formControlName="nationality"
                  placeholder="País de origem"
                />
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Escolaridade</mat-label>
                <mat-select formControlName="graduation">
                  <mat-option
                    *ngFor="let graduation of graduationOptions"
                    [value]="graduation"
                  >
                    {{ graduation }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Nome do Pai</mat-label>
                <input
                  matInput
                  formControlName="fatherName"
                  placeholder="Nome completo do pai"
                />
              </mat-form-field>

              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Nome da Mãe</mat-label>
                <input
                  matInput
                  formControlName="motherName"
                  placeholder="Nome completo da mãe"
                />
              </mat-form-field>
            </div>

            <div class="button-row">
              <button mat-button matStepperNext type="button" color="primary">
                Próximo
              </button>
            </div>
          </div>
        </mat-step>

        <!-- ETAPA 2: DOCUMENTAÇÃO -->
        <mat-step [stepControl]="employeeForm.get('documents')!">
          <ng-template matStepLabel>Documentação</ng-template>
          <div class="step-content" formGroupName="documents">
            <div class="form-row">
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>CPF</mat-label>
                <input
                  matInput
                  formControlName="cpf"
                  placeholder="000.000.000-00"
                  mask="000.000.000-00"
                  (blur)="validateCpf()"
                />
                <mat-error
                  *ngIf="employeeForm.get('documents.cpf')?.hasError('invalidCpf')"
                >
                  CPF inválido. Verifique os dígitos.
                </mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="half-width">
                <mat-label>RG</mat-label>
                <input
                  matInput
                  formControlName="rg"
                  placeholder="00.000.000-0"
                />
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Órgão Emissor</mat-label>
                <input
                  matInput
                  formControlName="rgEmitter"
                  placeholder="SSP/UF"
                />
              </mat-form-field>

              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Data de Emissão</mat-label>
                <input
                  matInput
                  [matDatepicker]="rgEmissionPicker"
                  formControlName="rgEmissionDate"
                />
                <mat-datepicker-toggle
                  matSuffix
                  [for]="rgEmissionPicker"
                ></mat-datepicker-toggle>
                <mat-datepicker #rgEmissionPicker></mat-datepicker>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>PIS/PASEP</mat-label>
                <input
                  matInput
                  formControlName="pisPasep"
                  placeholder="000.00000.00-0"
                  mask="000.00000.00-0"
                />
              </mat-form-field>

              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Título de Eleitor</mat-label>
                <input
                  matInput
                  formControlName="voterTitle"
                  placeholder="0000 0000 0000"
                  mask="0000 0000 0000"
                />
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="third-width">
                <mat-label>Zona Eleitoral</mat-label>
                <input
                  matInput
                  formControlName="voterZone"
                  placeholder="000"
                  mask="000"
                />
              </mat-form-field>

              <mat-form-field appearance="outline" class="third-width">
                <mat-label>Seção Eleitoral</mat-label>
                <input
                  matInput
                  formControlName="voterSection"
                  placeholder="0000"
                  mask="0000"
                />
              </mat-form-field>

              <mat-form-field appearance="outline" class="third-width">
                <mat-label>Data de Emissão</mat-label>
                <input
                  matInput
                  [matDatepicker]="voterEmissionPicker"
                  formControlName="voterEmission"
                />
                <mat-datepicker-toggle
                  matSuffix
                  [for]="voterEmissionPicker"
                ></mat-datepicker-toggle>
                <mat-datepicker #voterEmissionPicker></mat-datepicker>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Certificado Militar</mat-label>
                <input
                  matInput
                  formControlName="militaryCertificate"
                  placeholder="Número do certificado"
                />
              </mat-form-field>

              <mat-form-field appearance="outline" class="half-width">
                <mat-label>CTPS</mat-label>
                <input
                  matInput
                  formControlName="ctps"
                  placeholder="0000000"
                  mask="0000000"
                />
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Série CTPS</mat-label>
                <input
                  matInput
                  formControlName="ctpsSerie"
                  placeholder="000-0"
                  mask="000-0"
                />
              </mat-form-field>
            </div>

            <mat-divider class="section-divider"></mat-divider>

            <div class="form-row">
              <mat-checkbox formControlName="driversLicense" class="full-width">
                Possui Carteira de Habilitação
              </mat-checkbox>
            </div>

            <div
              class="form-row"
              *ngIf="employeeForm.get('documents.driversLicense')?.value"
            >
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Número da CNH</mat-label>
                <input
                  matInput
                  formControlName="driversLicenseNumber"
                  placeholder="00000000000"
                  mask="00000000000"
                />
              </mat-form-field>

              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Categoria</mat-label>
                <mat-select formControlName="driversLicenseCategory">
                  <mat-option
                    *ngFor="let category of driverLicenseCategoryOptions"
                    [value]="category"
                  >
                    {{ category }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <div
              class="form-row"
              *ngIf="employeeForm.get('documents.driversLicense')?.value"
            >
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Data de Emissão</mat-label>
                <input
                  matInput
                  [matDatepicker]="driverEmissionPicker"
                  formControlName="driversLicenseEmissionDate"
                />
                <mat-datepicker-toggle
                  matSuffix
                  [for]="driverEmissionPicker"
                ></mat-datepicker-toggle>
                <mat-datepicker #driverEmissionPicker></mat-datepicker>
              </mat-form-field>

              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Data de Validade</mat-label>
                <input
                  matInput
                  [matDatepicker]="driverExpirationPicker"
                  formControlName="driversLicenseExpirationDate"
                />
                <mat-datepicker-toggle
                  matSuffix
                  [for]="driverExpirationPicker"
                ></mat-datepicker-toggle>
                <mat-datepicker #driverExpirationPicker></mat-datepicker>
              </mat-form-field>
            </div>

            <div class="button-row">
              <button mat-button matStepperPrevious type="button">
                Voltar
              </button>
              <button mat-button matStepperNext type="button" color="primary">
                Próximo
              </button>
            </div>
          </div>
        </mat-step>

        <!-- ETAPA 3: CONTATO E ENDEREÇO -->
        <mat-step [stepControl]="employeeForm.get('contactAddress')!">
          <ng-template matStepLabel>Contato e Endereço</ng-template>
          <div class="step-content" formGroupName="contactAddress">
            <div class="form-row">
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Telefone</mat-label>
                <input
                  matInput
                  formControlName="phone"
                  placeholder="(00) 0000-0000"
                  mask="(00) 0000-0000"
                />
                <input
                  matInput
                  formControlName="phone"
                  placeholder="(00) 0000-0000"
                  [mask]="getPhoneMask('phone')"
                  (input)="onPhoneInput('phone', $event)"
                />
                <mat-error
                  *ngIf="employeeForm
                      .get('contactAddress.phone')
                      ?.hasError('invalidPhone')"
                >
                  Telefone inválido. Use o formato (00) 0000-0000 ou (00)
                  00000-0000.
                </mat-error>
              </mat-form-field>

              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Celular</mat-label>
                <input
                  matInput
                  formControlName="mobile"
                  placeholder="(00) 00000-0000"
                  mask="(00) 00000-0000"
                />
                <input
                  matInput
                  formControlName="mobile"
                  placeholder="(00) 00000-0000"
                  [mask]="getPhoneMask('mobile')"
                  (input)="onPhoneInput('mobile', $event)"
                />
                <mat-error
                  *ngIf="employeeForm
                      .get('contactAddress.mobile')
                      ?.hasError('invalidPhone')"
                >
                  Celular inválido. Use o formato (00) 00000-0000.
                </mat-error>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>CEP</mat-label>
                <input
                  matInput
                  formControlName="cep"
                  placeholder="00000-000"
                  mask="00000-000"
                  (blur)="searchAddressByCep('contactAddress.cep')"
                />
                <mat-icon
                  matSuffix
                  class="clickable"
                  matTooltip="Buscar endereço pelo CEP"
                  (click)="searchAddressByCep('contactAddress.cep')"
                  >search</mat-icon
                >
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="three-quarters-width">
                <mat-label>Endereço</mat-label>
                <input
                  matInput
                  formControlName="employeeAddress"
                  placeholder="Rua, Avenida, etc."
                />
              </mat-form-field>

              <mat-form-field appearance="outline" class="quarter-width">
                <mat-label>Número</mat-label>
                <input
                  matInput
                  formControlName="employeeAddressNumber"
                  placeholder="Nº"
                />
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Complemento</mat-label>
                <input
                  matInput
                  formControlName="employeeAddressComplement"
                  placeholder="Apto, Bloco, etc."
                />
              </mat-form-field>

              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Bairro</mat-label>
                <input
                  matInput
                  formControlName="employeeNeighborhood"
                  placeholder="Bairro"
                />
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="two-thirds-width">
                <mat-label>Cidade</mat-label>
                <input
                  matInput
                  formControlName="employeeAddressCity"
                  placeholder="Cidade"
                />
              </mat-form-field>

              <mat-form-field appearance="outline" class="third-width">
                <mat-label>Estado</mat-label>
                <mat-select formControlName="employeeAddressState">
                  <mat-option *ngFor="let state of states" [value]="state">
                    {{ state }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <div class="button-row">
              <button mat-button matStepperPrevious type="button">
                Voltar
              </button>
              <button mat-button matStepperNext type="button" color="primary">
                Próximo
              </button>
            </div>
          </div>
        </mat-step>

        <!-- ETAPA 4: INFORMAÇÕES FAMILIARES -->
        <mat-step [stepControl]="employeeForm.get('familyInfo')!">
          <ng-template matStepLabel>Informações Familiares</ng-template>
          <div class="step-content" formGroupName="familyInfo">
            <h3>Informações do Cônjuge</h3>
            <div class="form-row">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Nome do Cônjuge</mat-label>
                <input
                  matInput
                  formControlName="partnerName"
                  placeholder="Nome completo do cônjuge"
                />
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>CPF do Cônjuge</mat-label>
                <input
                  matInput
                  formControlName="partnerCpf"
                  placeholder="000.000.000-00"
                  mask="000.000.000-00"
                />
              </mat-form-field>

              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Data de Nascimento</mat-label>
                <input
                  matInput
                  [matDatepicker]="partnerBirthdayPicker"
                  formControlName="partnerBirthday"
                />
                <mat-datepicker-toggle
                  matSuffix
                  [for]="partnerBirthdayPicker"
                ></mat-datepicker-toggle>
                <mat-datepicker #partnerBirthdayPicker></mat-datepicker>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>RG do Cônjuge</mat-label>
                <input
                  matInput
                  formControlName="partnerRg"
                  placeholder="00.000.000-0"
                />
              </mat-form-field>
            </div>

            <mat-divider class="section-divider"></mat-divider>

            <h3>
              Dependentes
              <button
                type="button"
                mat-mini-fab
                color="primary"
                (click)="addDependent()"
                class="add-button"
              >
                <mat-icon>add</mat-icon>
              </button>
            </h3>

            <div formArrayName="dependents">
              <div
                *ngFor="let dependent of dependents.controls; let i = index"
                [formGroupName]="i"
                class="array-item"
              >
                <h4>
                  Dependente {{ i + 1 }}
                  <button
                    type="button"
                    mat-icon-button
                    color="warn"
                    (click)="removeDependent(i)"
                    class="remove-button"
                  >
                    <mat-icon>delete</mat-icon>
                  </button>
                </h4>

                <div class="form-row">
                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Nome do Dependente</mat-label>
                    <input
                      matInput
                      formControlName="dependentName"
                      placeholder="Nome completo do dependente"
                    />
                  </mat-form-field>
                </div>

                <div class="form-row">
                  <mat-form-field appearance="outline" class="half-width">
                    <mat-label>CPF do Dependente</mat-label>
                    <input
                      matInput
                      formControlName="dependentCpf"
                      placeholder="000.000.000-00"
                      mask="000.000.000-00"
                    />
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="half-width">
                    <mat-label>Data de Nascimento</mat-label>
                    <input
                      matInput
                      [matDatepicker]="dependentBirthdayPicker"
                      formControlName="dependentBirthday"
                    />
                    <mat-datepicker-toggle
                      matSuffix
                      [for]="dependentBirthdayPicker"
                    ></mat-datepicker-toggle>
                    <mat-datepicker #dependentBirthdayPicker></mat-datepicker>
                  </mat-form-field>
                </div>

                <div class="form-row">
                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Parentesco</mat-label>
                    <mat-select formControlName="dependentRelationship">
                      <mat-option
                        *ngFor="let relationship of relationshipOptions"
                        [value]="relationship"
                      >
                        {{ relationship }}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
              </div>
            </div>

            <div class="button-row">
              <button mat-button matStepperPrevious type="button">
                Voltar
              </button>
              <button mat-button matStepperNext type="button" color="primary">
                Próximo
              </button>
            </div>
          </div>
        </mat-step>

        <!-- ETAPA 5: INFORMAÇÕES PROFISSIONAIS -->
        <mat-step [stepControl]="employeeForm.get('professionalInfo')!">
          <ng-template matStepLabel>Informações Profissionais</ng-template>
          <div class="step-content" formGroupName="professionalInfo">
            <div class="form-row">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Cargo</mat-label>
                <mat-select formControlName="jobPosition">
                  <mat-option
                    *ngFor="let cargo of cargoOptions"
                    [value]="cargo"
                  >
                    {{ cargo }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Funções</mat-label>
                <textarea
                  matInput
                  formControlName="jobFunctions"
                  placeholder="Descrição das funções"
                ></textarea>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Data de Admissão</mat-label>
                <input
                  matInput
                  [matDatepicker]="admissionDatePicker"
                  formControlName="admissionDate"
                />
                <mat-datepicker-toggle
                  matSuffix
                  [for]="admissionDatePicker"
                ></mat-datepicker-toggle>
                <mat-datepicker #admissionDatePicker></mat-datepicker>
              </mat-form-field>

              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Período</mat-label>
                <input
                  matInput
                  formControlName="period"
                  placeholder="Manhã, Tarde, Noite, Integral"
                />
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Data de Expiração do Contrato</mat-label>
                <input
                  matInput
                  [matDatepicker]="contractExpirationPicker"
                  formControlName="contractExpirationDate"
                />
                <mat-datepicker-toggle
                  matSuffix
                  [for]="contractExpirationPicker"
                ></mat-datepicker-toggle>
                <mat-datepicker #contractExpirationPicker></mat-datepicker>
              </mat-form-field>

              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Status do Contrato</mat-label>
                <mat-select formControlName="status">
                  <mat-option
                    *ngFor="let status of statusOptions"
                    [value]="status"
                  >
                    {{ status }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="third-width">
                <mat-label>Horas Diárias</mat-label>
                <input
                  matInput
                  formControlName="dailyHours"
                  placeholder="Ex: 8h"
                />
              </mat-form-field>

              <mat-form-field appearance="outline" class="third-width">
                <mat-label>Horas Semanais</mat-label>
                <input
                  matInput
                  formControlName="weeklyHours"
                  placeholder="Ex: 40h"
                />
              </mat-form-field>

              <mat-form-field appearance="outline" class="third-width">
                <mat-label>Horas Mensais</mat-label>
                <input
                  matInput
                  formControlName="monthlyHours"
                  placeholder="Ex: 160h"
                />
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Aulas Semanais</mat-label>
                <input
                  matInput
                  formControlName="weeklyClasses"
                  placeholder="Número de aulas semanais"
                />
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-checkbox formControlName="hasAccumulate" class="full-width">
                Possui acúmulo de cargo
              </mat-checkbox>
            </div>

            <div
              class="form-row"
              *ngIf="employeeForm.get('professionalInfo.hasAccumulate')?.value"
            >
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Empresa do acúmulo</mat-label>
                <input
                  matInput
                  formControlName="hasAccumulateCompany"
                  placeholder="Nome da empresa"
                />
              </mat-form-field>
            </div>

            <div class="button-row">
              <button mat-button matStepperPrevious type="button">
                Voltar
              </button>
              <button mat-button matStepperNext type="button" color="primary">
                Próximo
              </button>
            </div>
          </div>
        </mat-step>

        <!-- ETAPA 6: INFORMAÇÕES FINANCEIRAS -->
        <mat-step [stepControl]="employeeForm.get('financialInfo')!">
          <ng-template matStepLabel>Informações Financeiras</ng-template>
          <div class="step-content" formGroupName="financialInfo">
            <div class="form-row">
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Salário</mat-label>
                <input
                  matInput
                  formControlName="salary"
                  placeholder="0,00"
                  type="number"
                  step="0.01"
                />
                <span matPrefix>R$ &nbsp;</span>
              </mat-form-field>

              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Salário Família</mat-label>
                <input
                  matInput
                  formControlName="familySalary"
                  placeholder="0,00"
                  type="number"
                  step="0.01"
                />
                <span matPrefix>R$ &nbsp;</span>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Banco</mat-label>
                <input
                  matInput
                  formControlName="salaryBank"
                  placeholder="Nome do banco"
                />
              </mat-form-field>

              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Agência</mat-label>
                <input
                  matInput
                  formControlName="salaryAgency"
                  placeholder="Número da agência"
                />
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Conta</mat-label>
                <input
                  matInput
                  formControlName="salaryAccount"
                  placeholder="Número da conta"
                />
              </mat-form-field>

              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Tipo de Conta</mat-label>
                <mat-select formControlName="salaryAccountType">
                  <mat-option value="CORRENTE">Corrente</mat-option>
                  <mat-option value="POUPANCA">Poupança</mat-option>
                  <mat-option value="SALARIO">Salário</mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Parentesco</mat-label>
                <input
                  matInput
                  formControlName="parenting"
                  placeholder="Parentesco"
                />
              </mat-form-field>

              <mat-form-field appearance="outline" class="half-width">
                <mat-label>IRPF</mat-label>
                <input
                  matInput
                  formControlName="irpf"
                  placeholder="Informações de IRPF"
                />
              </mat-form-field>
            </div>

            <div class="button-row">
              <button mat-button matStepperPrevious type="button">
                Voltar
              </button>
              <button mat-button matStepperNext type="button" color="primary">
                Próximo
              </button>
            </div>
          </div>
        </mat-step>

        <!-- ETAPA 7: BENEFÍCIOS E ADICIONAIS -->
        <mat-step [stepControl]="employeeForm.get('benefits')!">
          <ng-template matStepLabel>Benefícios</ng-template>
          <div class="step-content" formGroupName="benefits">
            <div class="form-row">
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Valor Refeição</mat-label>
                <input
                  matInput
                  formControlName="mealValue"
                  placeholder="0,00"
                  type="number"
                  step="0.01"
                />
                <span matPrefix>R$ &nbsp;</span>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-checkbox formControlName="transport" class="full-width">
                Utiliza Vale Transporte
              </mat-checkbox>
            </div>

            <div
              class="form-row"
              *ngIf="employeeForm.get('benefits.transport')?.value"
            >
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Tipo de Transporte</mat-label>
                <input
                  matInput
                  formControlName="transportType"
                  placeholder="Ex: Ônibus, Metrô"
                />
              </mat-form-field>

              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Valor do Transporte</mat-label>
                <input
                  matInput
                  formControlName="transportValue"
                  placeholder="0,00"
                  type="number"
                  step="0.01"
                />
                <span matPrefix>R$ &nbsp;</span>
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Plano de Saúde</mat-label>
                <input
                  matInput
                  formControlName="healthPlan"
                  placeholder="Nome do plano"
                />
              </mat-form-field>

              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Número da Carteirinha</mat-label>
                <input
                  matInput
                  formControlName="healthCardNumber"
                  placeholder="Número da carteirinha"
                />
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-checkbox formControlName="deficiency" class="full-width">
                Possui Deficiência
              </mat-checkbox>
            </div>

            <div
              class="form-row"
              *ngIf="employeeForm.get('benefits.deficiency')?.value"
            >
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Descrição da Deficiência</mat-label>
                <textarea
                  matInput
                  formControlName="deficiencyDescription"
                  placeholder="Descreva a deficiência"
                ></textarea>
              </mat-form-field>
            </div>

            <div class="button-row">
              <button mat-button matStepperPrevious type="button">
                Voltar
              </button>
              <button mat-button matStepperNext type="button" color="primary">
                Próximo
              </button>
            </div>
          </div>
        </mat-step>

        <!-- ETAPA 8: INFORMAÇÕES DE ESTÁGIO/FACULDADE -->
        <mat-step [stepControl]="employeeForm.get('collegeInfo')!">
          <ng-template matStepLabel>Informações Acadêmicas</ng-template>
          <div class="step-content" formGroupName="collegeInfo">
            <div class="form-row">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Faculdade/Instituição</mat-label>
                <input
                  matInput
                  formControlName="college"
                  placeholder="Nome da instituição"
                />
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Curso</mat-label>
                <input
                  matInput
                  formControlName="course"
                  placeholder="Nome do curso"
                />
              </mat-form-field>

              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Período de Formação</mat-label>
                <input
                  matInput
                  formControlName="trainingPeriod"
                  placeholder="Ex: 2020-2024"
                />
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>RA</mat-label>
                <input
                  matInput
                  formControlName="ra"
                  placeholder="Registro Acadêmico"
                />
              </mat-form-field>

              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Apólice de Seguro de Vida</mat-label>
                <input
                  matInput
                  formControlName="lifInsurancePolicy"
                  placeholder="Número da apólice"
                />
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>CEP da Instituição</mat-label>
                <input
                  matInput
                  formControlName="collegeCep"
                  placeholder="00000-000"
                  mask="00000-000"
                  (blur)="searchAddressByCep('collegeInfo.collegeCep')"
                />
                <mat-icon
                  matSuffix
                  class="clickable"
                  matTooltip="Buscar endereço pelo CEP"
                  (click)="searchAddressByCep('collegeInfo.collegeCep')"
                  >search</mat-icon
                >
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="three-quarters-width">
                <mat-label>Endereço da Instituição</mat-label>
                <input
                  matInput
                  formControlName="traineeAddress"
                  placeholder="Rua, Avenida, etc."
                />
              </mat-form-field>

              <mat-form-field appearance="outline" class="quarter-width">
                <mat-label>Número</mat-label>
                <input
                  matInput
                  formControlName="traineeAddressNumber"
                  type="number"
                  placeholder="Nº"
                />
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Complemento</mat-label>
                <input
                  matInput
                  formControlName="traineeAddressComplement"
                  placeholder="Apto, Bloco, etc."
                />
              </mat-form-field>

              <mat-form-field appearance="outline" class="half-width">
                <mat-label>Bairro</mat-label>
                <input
                  matInput
                  formControlName="traineeAddressNeighborhood"
                  placeholder="Bairro"
                />
              </mat-form-field>
            </div>

            <div class="form-row">
              <mat-form-field appearance="outline" class="two-thirds-width">
                <mat-label>Cidade</mat-label>
                <input
                  matInput
                  formControlName="traineeAddressCity"
                  placeholder="Cidade"
                />
              </mat-form-field>

              <mat-form-field appearance="outline" class="third-width">
                <mat-label>Estado</mat-label>
                <mat-select formControlName="traineeAddressState">
                  <mat-option *ngFor="let state of states" [value]="state">
                    {{ state }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <div class="button-row">
              <button mat-button matStepperPrevious type="button">
                Voltar
              </button>
              <button mat-button matStepperNext type="button" color="primary">
                Próximo
              </button>
            </div>
          </div>
        </mat-step>

        <!-- ETAPA 9: CONTATOS DE EMERGÊNCIA -->
        <mat-step>
          <ng-template matStepLabel>Contatos de Emergência</ng-template>
          <div class="step-content">
            <h3>
              Contatos de Emergência
              <button
                type="button"
                mat-mini-fab
                color="primary"
                (click)="addEmergencyContact()"
                class="add-button"
              >
                <mat-icon>add</mat-icon>
              </button>
            </h3>

            <div formArrayName="emergencyContacts">
              <div
                *ngFor="
                  let contact of emergencyContacts.controls;
                  let i = index
                "
                [formGroupName]="i"
                class="array-item"
              >
                <h4>
                  Contato {{ i + 1 }}
                  <button
                    type="button"
                    mat-icon-button
                    color="warn"
                    (click)="removeEmergencyContact(i)"
                    class="remove-button"
                  >
                    <mat-icon>delete</mat-icon>
                  </button>
                </h4>

                <div class="form-row">
                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Nome do Contato</mat-label>
                    <input
                      matInput
                      formControlName="contactName"
                      placeholder="Nome completo do contato"
                    />
                  </mat-form-field>
                </div>

                <div class="form-row">
                  <mat-form-field appearance="outline" class="half-width">
                    <mat-label>Telefone</mat-label>
                    <input
                      matInput
                      formControlName="contactPhone"
                      placeholder="(00) 00000-0000"
                      mask="(00) 00000-0000"
                    />
                  </mat-form-field>

                  <mat-form-field appearance="outline" class="half-width">
                    <mat-label>E-mail</mat-label>
                    <input
                      matInput
                      formControlName="contactEmail"
                      placeholder="email@exemplo.com"
                      type="email"
                    />
                    <mat-error
                      *ngIf="contact.get('contactEmail')?.hasError('email')"
                    >
                      E-mail inválido
                    </mat-error>
                  </mat-form-field>
                </div>

                <div class="form-row">
                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Parentesco</mat-label>
                    <mat-select formControlName="contactRelationship">
                      <mat-option
                        *ngFor="let relationship of relationshipOptions"
                        [value]="relationship"
                      >
                        {{ relationship }}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
              </div>
            </div>

            <div class="button-row">
              <button mat-button matStepperPrevious type="button">
                Voltar
              </button>
              <button mat-button matStepperNext type="button" color="primary">
                Revisar
              </button>
            </div>
          </div>
        </mat-step>

        <!-- ETAPA 10: REVISÃO E ENVIO -->
        <mat-step>
          <ng-template matStepLabel>Revisar e Enviar</ng-template>
          <div class="step-content review-step">
            <h3>Revise as informações antes de enviar</h3>
            <p class="review-subtitle">
              Verifique se todos os dados estão corretos. Clique em qualquer campo para editá-lo rapidamente.
            </p>

            <!-- SEÇÃO: FOTO E INFORMAÇÕES BÁSICAS -->
            <mat-expansion-panel expanded="true" class="review-section">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <mat-icon>person</mat-icon>
                  Informações Básicas
                </mat-panel-title>
              </mat-expansion-panel-header>
              
              <div class="review-content">
                <div class="photo-review">
                  <div class="photo-preview-small" 
                       [style.backgroundImage]="selectedPhotoUrl ? 'url(' + selectedPhotoUrl + ')' : 'none'">
                    <mat-icon *ngIf="!selectedPhotoUrl">person</mat-icon>
                  </div>
                  <button mat-stroked-button (click)="fileInput.click()" type="button">
                    <mat-icon>photo_camera</mat-icon>
                    {{ selectedPhotoUrl ? 'Alterar' : 'Adicionar' }} Foto
                  </button>
                </div>

                <div class="review-fields">
                  <div class="review-field-group">
                    <div class="review-field" (click)="goToStep(0)">
                      <span class="field-label">Nome Completo:</span>
                      <span class="field-value">{{ employeeForm.get('basicInfo.fullName')?.value || '(não informado)' }}</span>
                      <mat-icon class="edit-icon">edit</mat-icon>
                    </div>
                    
                    <div class="review-field" (click)="goToStep(0)">
                      <span class="field-label">E-mail:</span>
                      <span class="field-value">{{ employeeForm.get('basicInfo.email')?.value || '(não informado)' }}</span>
                      <mat-icon class="edit-icon">edit</mat-icon>
                    </div>

                    <div class="review-field" (click)="goToStep(0)">
                      <span class="field-label">Data de Nascimento:</span>
                      <span class="field-value">{{ formatDate(employeeForm.get('basicInfo.birthday')?.value) || '(não informado)' }}</span>
                      <mat-icon class="edit-icon">edit</mat-icon>
                    </div>

                    <div class="review-field" (click)="goToStep(0)">
                      <span class="field-label">Gênero:</span>
                      <span class="field-value">{{ employeeForm.get('basicInfo.gender')?.value || '(não informado)' }}</span>
                      <mat-icon class="edit-icon">edit</mat-icon>
                    </div>

                    <div class="review-field" (click)="goToStep(0)">
                      <span class="field-label">Estado Civil:</span>
                      <span class="field-value">{{ employeeForm.get('basicInfo.maritalStatus')?.value || '(não informado)' }}</span>
                      <mat-icon class="edit-icon">edit</mat-icon>
                    </div>
                  </div>
                </div>
              </div>
            </mat-expansion-panel>

            <!-- SEÇÃO: DOCUMENTOS -->
            <mat-expansion-panel class="review-section">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <mat-icon>description</mat-icon>
                  Documentos
                </mat-panel-title>
              </mat-expansion-panel-header>
              
              <div class="review-content">
                <div class="review-fields">
                  <div class="review-field" (click)="goToStep(1)">
                    <span class="field-label">CPF:</span>
                    <span class="field-value">{{ employeeForm.get('documents.cpf')?.value || '(não informado)' }}</span>
                    <mat-icon class="edit-icon">edit</mat-icon>
                  </div>

                  <div class="review-field" (click)="goToStep(1)">
                    <span class="field-label">RG:</span>
                    <span class="field-value">{{ employeeForm.get('documents.rg')?.value || '(não informado)' }}</span>
                    <mat-icon class="edit-icon">edit</mat-icon>
                  </div>

                  <div class="review-field" (click)="goToStep(1)">
                    <span class="field-label">CTPS:</span>
                    <span class="field-value">{{ employeeForm.get('documents.ctps')?.value || '(não informado)' }}</span>
                    <mat-icon class="edit-icon">edit</mat-icon>
                  </div>

                  <div class="review-field" (click)="goToStep(1)">
                    <span class="field-label">PIS/PASEP:</span>
                    <span class="field-value">{{ employeeForm.get('documents.pisPasep')?.value || '(não informado)' }}</span>
                    <mat-icon class="edit-icon">edit</mat-icon>
                  </div>
                </div>
              </div>
            </mat-expansion-panel>

            <!-- SEÇÃO: CONTATO E ENDEREÇO -->
            <mat-expansion-panel class="review-section">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <mat-icon>location_on</mat-icon>
                  Contato e Endereço
                </mat-panel-title>
              </mat-expansion-panel-header>
              
              <div class="review-content">
                <div class="review-fields">
                  <div class="review-field" (click)="goToStep(2)">
                    <span class="field-label">Telefone:</span>
                    <span class="field-value">{{ employeeForm.get('contactAddress.phone')?.value || '(não informado)' }}</span>
                    <mat-icon class="edit-icon">edit</mat-icon>
                  </div>

                  <div class="review-field" (click)="goToStep(2)">
                    <span class="field-label">Celular:</span>
                    <span class="field-value">{{ employeeForm.get('contactAddress.mobile')?.value || '(não informado)' }}</span>
                    <mat-icon class="edit-icon">edit</mat-icon>
                  </div>

                  <div class="review-field" (click)="goToStep(2)">
                    <span class="field-label">CEP:</span>
                    <span class="field-value">{{ employeeForm.get('contactAddress.cep')?.value || '(não informado)' }}</span>
                    <mat-icon class="edit-icon">edit</mat-icon>
                  </div>

                  <div class="review-field" (click)="goToStep(2)">
                    <span class="field-label">Endereço Completo:</span>
                    <span class="field-value">{{ getFullAddress() || '(não informado)' }}</span>
                    <mat-icon class="edit-icon">edit</mat-icon>
                  </div>
                </div>
              </div>
            </mat-expansion-panel>

            <!-- SEÇÃO: INFORMAÇÕES PROFISSIONAIS -->
            <mat-expansion-panel class="review-section">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <mat-icon>work</mat-icon>
                  Informações Profissionais
                </mat-panel-title>
              </mat-expansion-panel-header>
              
              <div class="review-content">
                <div class="review-fields">
                  <div class="review-field" (click)="goToStep(4)">
                    <span class="field-label">Cargo:</span>
                    <span class="field-value">{{ employeeForm.get('professionalInfo.jobPosition')?.value || '(não informado)' }}</span>
                    <mat-icon class="edit-icon">edit</mat-icon>
                  </div>

                  <div class="review-field" (click)="goToStep(4)">
                    <span class="field-label">Data de Admissão:</span>
                    <span class="field-value">{{ formatDate(employeeForm.get('professionalInfo.admissionDate')?.value) || '(não informado)' }}</span>
                    <mat-icon class="edit-icon">edit</mat-icon>
                  </div>

                  <div class="review-field" (click)="goToStep(4)">
                    <span class="field-label">Status:</span>
                    <span class="field-value">{{ employeeForm.get('professionalInfo.status')?.value || '(não informado)' }}</span>
                    <mat-icon class="edit-icon">edit</mat-icon>
                  </div>

                  <div class="review-field" (click)="goToStep(4)">
                    <span class="field-label">Período:</span>
                    <span class="field-value">{{ employeeForm.get('professionalInfo.period')?.value || '(não informado)' }}</span>
                    <mat-icon class="edit-icon">edit</mat-icon>
                  </div>
                </div>
              </div>
            </mat-expansion-panel>

            <!-- SEÇÃO: INFORMAÇÕES FINANCEIRAS -->
            <mat-expansion-panel class="review-section">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <mat-icon>attach_money</mat-icon>
                  Informações Financeiras
                </mat-panel-title>
              </mat-expansion-panel-header>
              
              <div class="review-content">
                <div class="review-fields">
                  <div class="review-field" (click)="goToStep(5)">
                    <span class="field-label">Salário:</span>
                    <span class="field-value">{{ formatCurrency(employeeForm.get('financialInfo.salary')?.value) || '(não informado)' }}</span>
                    <mat-icon class="edit-icon">edit</mat-icon>
                  </div>

                  <div class="review-field" (click)="goToStep(5)">
                    <span class="field-label">Banco:</span>
                    <span class="field-value">{{ employeeForm.get('financialInfo.salaryBank')?.value || '(não informado)' }}</span>
                    <mat-icon class="edit-icon">edit</mat-icon>
                  </div>

                  <div class="review-field" (click)="goToStep(5)">
                    <span class="field-label">Agência:</span>
                    <span class="field-value">{{ employeeForm.get('financialInfo.salaryAgency')?.value || '(não informado)' }}</span>
                    <mat-icon class="edit-icon">edit</mat-icon>
                  </div>

                  <div class="review-field" (click)="goToStep(5)">
                    <span class="field-label">Conta:</span>
                    <span class="field-value">{{ employeeForm.get('financialInfo.salaryAccount')?.value || '(não informado)' }}</span>
                    <mat-icon class="edit-icon">edit</mat-icon>
                  </div>
                </div>
              </div>
            </mat-expansion-panel>

            <!-- SEÇÃO: CONTATOS DE EMERGÊNCIA -->
            <mat-expansion-panel class="review-section">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <mat-icon>contact_emergency</mat-icon>
                  Contatos de Emergência
                </mat-panel-title>
              </mat-expansion-panel-header>
              
              <div class="review-content">
                <div class="emergency-contacts-review">
                  <div *ngFor="let contact of emergencyContacts.controls; let i = index" 
                       class="contact-review-item" 
                       (click)="goToStep(8)">
                    <div class="contact-header">
                      <span class="contact-number">Contato {{ i + 1 }}</span>
                      <mat-icon class="edit-icon">edit</mat-icon>
                    </div>
                    <div class="contact-details">
                      <span><strong>Nome:</strong> {{ contact.get('contactName')?.value || '(não informado)' }}</span>
                      <span><strong>Telefone:</strong> {{ contact.get('contactPhone')?.value || '(não informado)' }}</span>
                      <span><strong>Parentesco:</strong> {{ contact.get('contactRelationship')?.value || '(não informado)' }}</span>
                    </div>
                  </div>
                  
                  <div *ngIf="emergencyContacts.length === 0" class="no-contacts">
                    <span>Nenhum contato de emergência cadastrado</span>
                    <button mat-button color="primary" (click)="goToStep(8)" type="button">
                      <mat-icon>add</mat-icon>
                      Adicionar Contato
                    </button>
                  </div>
                </div>
              </div>
            </mat-expansion-panel>

            <!-- RESUMO DE VALIDAÇÃO -->
            <mat-card class="validation-summary" [ngClass]="getValidationSummaryClass()">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>{{ getValidationIcon() }}</mat-icon>
                  Status da Validação
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <div class="validation-item" *ngFor="let validation of getValidationSummary()">
                  <mat-icon [color]="validation.valid ? 'primary' : 'warn'">
                    {{ validation.valid ? 'check_circle' : 'error' }}
                  </mat-icon>
                  <span>{{ validation.message }}</span>
                  <button *ngIf="!validation.valid" 
                          mat-button 
                          color="primary" 
                          (click)="goToStep(validation.stepIndex)" 
                          type="button">
                    Corrigir
                  </button>
                </div>
              </mat-card-content>
            </mat-card>

            <div class="button-row review-actions">
              <button mat-button matStepperPrevious type="button">
                <mat-icon>arrow_back</mat-icon>
                Voltar
              </button>
              <button mat-button (click)="resetForm()" type="button">
                <mat-icon>clear_all</mat-icon>
                Limpar Tudo
              </button>
              <button mat-raised-button 
                      color="primary" 
                      type="submit"
                      [disabled]="!employeeForm || employeeForm.invalid || isSubmitting">
                <mat-icon>{{ isSubmitting ? 'hourglass_empty' : 'save' }}</mat-icon>
                {{ isSubmitting ? 'Salvando...' : (isEditMode ? 'Atualizar Funcionário' : 'Salvar Funcionário') }}
              </button>
            </div>
          </div>
        </mat-step>
      </mat-stepper>
    </form>
  </mat-card-content>
</mat-card>

<mat-card-actions align="end">
  <button mat-button type="button" (click)="cancel()">Cancelar</button>
  <button mat-button type="button" (click)="testApiConfiguration()" color="basic" *ngIf="isEditMode">
    Config API
  </button>
  <button mat-button type="button" (click)="testEmployeeExists()" color="warn" *ngIf="isEditMode">
    Testar Get
  </button>
  <button mat-button type="button" (click)="testFixedDataSubmit()" color="primary" *ngIf="isEditMode">
    Teste Fixo
  </button>
  <button mat-button type="button" (click)="testMinimalSubmit()" color="accent" *ngIf="isEditMode">
    Teste Mínimo
  </button>
  <button
    mat-raised-button
    color="primary"
    type="submit"
    (click)="onSubmit()"
    [disabled]="!employeeForm || employeeForm.invalid"
  >
    {{ isEditMode ? "Atualizar" : "Salvar" }}
  </button>
</mat-card-actions>
